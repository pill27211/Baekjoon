# [Platinum V] 두 단계 최단 경로 4 - 23840

[문제 링크](https://www.acmicpc.net/problem/23840)

### 문제 요약

<p> $N$개의 정점으로 이루어진 그래프와 $P$개의 중간 정점이 주어진다. 출발 정점 $X$에서 $P$개의 중간 정점 모두를 거친 후 도착 정점 $Z$에 도달하는 최단 거리를 구해보자. </p>

### 제한

TL : 7sec, ML : 1024 MB

$10 ≤ N ≤ 100,000$

$10 ≤ M ≤ 300,000$

$1 ≤ w ≤ 1,000,000$

$3 ≤ P ≤ min(20, N - 3)$

### 성능 요약

메모리: 196032 KB, 시간: 3248 ms

### 분류

그래프 이론(graphs), 다익스트라(dijkstra), 다이나믹 프로그래밍(dp), 비트마스킹(bitmask), 비트필드를 이용한 다이나믹 프로그래밍(dp_bitfield), 외판원 순회 문제(tsp)

### comment

다익과 tsp가 합쳐진 재밌는 문제였다. 우선 조건 및 범위를 살펴보자.

$P$개의 중간 정점 모두를 반드시 거쳐야 한다. 또, $P$는 최대 20개란다. 시간 제한은 7초..

$P$의 범위가 그 짝 문제들처럼 굉장히 의심스럽다.

완탐 돌리기엔 TLE고, 상태 전이를 비트 단위에서 수행하는 비트dp론 돌만한 범위. 전형적인 비트dp의 냄새가 난다.

또, $P$개의 정점끼리는 방문 순서가 중요치 않으므로 비트dp를 tsp 문제로 바라볼 수 있다.

-----------------------------------------------------------------------------------------------------------------------------------------------------------------------

$D[i][j]$ : $P_i$에서 $j$번 정점을 방문하는 비용.

위 테이블은 최대 20번의 다익스트라를 수행하여 모두 채워 넣을 수 있다.

시간 제한과 자신의 코드를 믿자.

-----------------------------------------------------------------------------------------------------------------------------------------------------------------------

그럼 이제 남은 건 최소 순회를 찾아내는 것이다.

시작점( $s$ )과 도착점( $e$ )은 고정이지만 $P_i$를 어떻게 방문하는지에 대한 조건은 따로 없다.

따라서, 모든 $P_i$에 대해

$s$ -> $P_1$를 시작으로 하는 순회 -> $e$

$s$ -> $P_2$를 시작으로 하는 순회 -> $e$

.

.

$s$ -> $P_p$를 시작으로 하는 순회 -> $e$

결국 $min(D[P_i][s] +$ $tsp$ _ $start(P_i))$ 의 값을 찾아주면 된다.

임의의 순회에서 최종 $e$까지의 비용은 알다시피 $P$개의 모든 정점을 방문한 순간 마지막에 방문한 정점으로부터 $e$까지의 거리를 반환하면 된다.

-----------------------------------------------------------------------------------------------------------------------------------------------------------------------

이렇게 정리하고 보니 참 간단한데.. 처음에 $s$와 $e$를 $P$개의 정점에 넣고 통째로 tsp를 돌려 버렸다.

20개의 정점으로 tsp와 22개의 정점으로 tsp는 차이가 어마어마하다.

그렇게 TLE를 얻어 맞다가 정신 차리고 $s$와 $e$를 분리해 통과하였다.
