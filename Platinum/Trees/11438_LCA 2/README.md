
# [Platinum V] LCA 2 - 11438

[문제 링크](https://www.acmicpc.net/problem/11438)

### 문제 요약

<p> $n$개의 정점으로 이루어진 트리와 $q$개의 쿼리가 주어진다. 각 쿼리의 두 정점쌍에 대한 $LCA$를 구해보자. </p>

### 제한

TL : 1.5sec, ML : 256 MB

$1 ≤ n, q ≤ 100,000$

### 성능 요약

메모리: 19520 KB, 시간: 96 ms

### 분류

자료구조(data_structures), 트리(trees), 최소 공통 조상(lowest common ancestor), 희소 배열(sparse table)

### comment

$LCA$를 나이브하게 구하는 $O(N)$에서 벗어나, $O(logN)$의 복잡도로 구하기 시작하는 첫 문제이다.

$D[i]$ : 정점 $i$의 깊이, $dp[i][j]$ : 정점 $i$의 $2^j$ 번째 부모 정점이라고 하자.

그럼 $dp[i][j] = dp[dp[i][j - 1]][j - 1];$ 가 성립함에 따라 $O(N * logN)$의 전처리를 통해 위 테이블을 전부 채워넣을 수 있다.

--------------------------------------------------------------------------------------------------------------------------------------------------

이제 전처리한 이 친구들을 어떻게 써먹어야 두 정점쌍 $(p, q)$의 $LCA$를 $O(logN)$만에 구할 수 있을까 ?

우선 일반성을 유지한 채 두 정점이 같은 깊이가 될 때까지 깊이가 더 낮은 정점을 로그 단위로 끌어 올려주자.

그럼 이제 $p$와 $q$가 같은 정점이 되거나, 아니거나 둘 중 하나로 나뉜다.

후자일 때를 보자.

$dp[i][2^ceil(log2(100000))]$에서 하나씩 내려오며 $p$와 $q$의 부모가 다를 때마다 각각의 부모 정점으로 끌어 올려주자.

그럼 결국 $p$와 $q$가 하나의 정점만을 부모로 둔 자식 정점들이 된다.

따라서 최종적으로 두 정점의 $LCA$는 $dp[p][0]$이 되겠다.
