
# [Platinum I] 수열과 쿼리 8 - 13553

[문제 링크](https://www.acmicpc.net/problem/13553)

### 문제 요약

<p> 길이 $N$의 수열과 $Q$개의 쿼리가 주어진다. 각 쿼리의 구간 $[a, b]$ 내 $a ≤ i < j ≤ b$ 를 만족 하면서 $abs(N_i - N_j) ≤ K$ 인 쌍의 수를 구해보자. </p>

### 제한

TL : 3sec, ML : 512 MB

$1 ≤ N, Q, K, N_i ≤ 100\,000$

### 성능 요약

메모리: 4772 KB, 시간: 1788 ms

### 분류

자료구조(data_structures), 세그먼트 트리(segtree), 오프라인 쿼리(offlines_queries), mo's(mo's algorithm)

### comment
  
  mo's 기본 문제이다.
  
  우선 절댓값을 풀어보자.
  
  $abs(N_i - N_j) ≤ K$ -> $N_j - K ≤ N_i ≤ N_j + K$
  
  가 되며 사실상 이게 쿼리 내용의 전부이다. 또, 구간을 효율적으로 관리하기 위해 펜윅 트리를 사용하자.
  
  -----------------------------------------------------------------------------------------------------------------------------------------------------------------------
  
  * 현재 구간에 $N_i$ 가 추가 되려 할 때는 결국 펜윅 트리 상에 $N_i - K ≤ x ≤ N_i + K$ 인 x의 개수를 더해 주는 것과 같다.
  * 현재 구간에 $N_i$ 가 제외 되려 할 때는 결국 펜윅 트리 상에 $N_i - K ≤ x ≤ N_i + K$ 인 x의 개수를 빼주는 것과 같다.
  
  하나 주의할 것으로, $N_i - K$의 값이 $0$보다 작아지거나 $N_i + K$의 값이 $N$의 범위보다 커질 수 있으니 이 경우를 적절히 잡아 주도록 하자.
  
  항상 쿼리의 형태가 일정해서 오히려 더 쉽게 느껴지기도 한 것 같다.
