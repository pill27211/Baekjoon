# [Platinum IV] 다오의 행사 계획하기 - 26615

[문제 링크](https://www.acmicpc.net/problem/26615)

### 문제 요약

<p> LCA + imos  </p>

### 제한

TL : 1sec, ML : 512 MB

$2 ≤ N, M$

$4 ≤ N * M ≤ 10^5$

$1 ≤ T, K ≤ 10^5$

### 성능 요약

메모리: 19136 KB, 시간: 144 ms

### 분류

트리(trees), 최소 공통 조상(lowest common ancestor), 누적 합(prefix_sum)

### comment

왠지는 모르겠지만 입력이 살짝 귀찮게 들어온다.

2차원 행렬 형태 이므로 왼 쪽 맨 위 칸부터 오른 쪽 맨 아래 칸까지 순서대로 $1, 2, 3, N * M$ 번으로 새로이 번호를 메기자.

이는 지나 온 열의 수를 곱해주고 현재 행의 수를 더해주면 간단히 넘버링 할 수 있다.

후에 쿼리에서도 $(a_i, b_i)$, $(c_i, d_i)$의 형태로 주어지니 같은 방식을 적용해주자.

-----------------------------------------------------------------------------------------------------------------------------------------------------------------------

문제의 내용을 보면, 구간 단위 업데이트 쿼리가 누적 되다가 최종 결과를 구해야 한다.

전형적인 imos법의 형태이다.

구체적으로 $S_i$일 부터 $E_i$일에 대해 구간(경로)상에 $V_i$만큼 더해준다.

이때, 더해지는 총량은 트리 상 구간(경로) 내에 존재하는 정점의 수와 $V_i$를 곱한 값이 되겠다. 

임의의 두 정점 $p$, $q$를 잇는 경로 내에 존재하는 정점의 수는

$C_i$ $=$ $Depth[p] + Depth[q]$ $-$ $2 * Depth$[ $LCA(p, q)$ ] $+$ $1$

이 되므로 각 쿼리마다 위를 $S_i$에 더해주고, $E_i + 1$에 빼준 뒤 스위핑 해주면 된다.

